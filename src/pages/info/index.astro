---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/PageLayout.astro';

// Get the current URL for canonical link
const currentUrl = new URL(Astro.url.pathname, 'https://unmaskinglungcancer.ca').toString();

// Get all info pages that are not drafts
const allPages = (await getCollection('info'));

// Debug: Log all pages and their properties
console.log('All pages:', allPages.map(p => ({
  id: p.id,
  slug: p.slug,
  data: {
    title: p.data.title,
    draft: p.data.draft,
    publishDate: p.data.publishDate
  }
})));

const nonDraftPages = allPages.filter(page => !page.data.draft);
console.log('Non-draft pages:', nonDraftPages.length);

// Group pages by directory (public/professionals)
const publicPages = nonDraftPages.filter(page => page.id.startsWith('public/'));
const professionalPages = nonDraftPages.filter(page => page.id.startsWith('professionals/'));

console.log('Public pages:', publicPages.length);
console.log('Professional pages:', professionalPages.length);
console.log('Public page IDs:', publicPages.map(p => p.id));

// Set page metadata
const metadata = {
  title: 'Information & Resources',
  description: 'Educational resources and information about lung cancer, radon, and more.',
  canonical: currentUrl,
};
---

<Layout metadata={metadata}>
  <div class="max-w-4xl mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold mb-8">Information & Resources</h1>
    
    <section class="mb-12">
      <h2 class="text-2xl font-semibold mb-6">For Public & Patients</h2>
      {publicPages.length > 0 ? (
        <div class="grid md:grid-cols-2 gap-6">
          {publicPages.map(page => (
            <a 
              href={`/info/${page.slug}/`}
              class="block p-6 bg-white rounded-lg border border-gray-200 hover:border-blue-500 hover:shadow-lg transition-shadow"
            >
              <h3 class="text-xl font-semibold mb-2">{page.data.title}</h3>
              {page.data.excerpt && (
                <p class="text-gray-600 mb-3">{page.data.excerpt}</p>
              )}
              <span class="text-blue-600 font-medium">Read more →</span>
            </a>
          ))}
        </div>
      ) : (
        <p class="text-gray-600">No public resources available at the moment.</p>
      )}
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-semibold mb-6">For Healthcare Professionals</h2>
      {professionalPages.length > 0 ? (
        <div class="grid md:grid-cols-2 gap-6">
          {professionalPages.map(page => (
            <a 
              href={`/info/${page.slug}/`}
              class="block p-6 bg-white rounded-lg border border-gray-200 hover:border-blue-500 hover:shadow-lg transition-shadow"
            >
              <h3 class="text-xl font-semibold mb-2">{page.data.title}</h3>
              {page.data.excerpt && (
                <p class="text-gray-600 mb-3">{page.data.excerpt}</p>
              )}
              <span class="text-blue-600 font-medium">Read more →</span>
            </a>
          ))}
        </div>
      ) : (
        <p class="text-gray-600">No professional resources available at the moment.</p>
      )}
    </section>
  </div>
</Layout>
